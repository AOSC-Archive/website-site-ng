extend templates/master

block head-custom
  +meta-title("AOSC OS Downloads")
  +meta-description("Anthon Open Source Community")

append stylesheet
  //+include-css("/assets/css/flow.css")
  +include-css("/assets/css/os-download.css")
  style.
    .afe-static-banner {
      background-image: url("/assets/i/banner.min.svg");
      background-size: cover;
      background-position: center;
    }

block banner
  .row
    .col-md-12
      h1 GET AOSC OS
      h2 /* I don't know how it works, it just works. */

block content
  #wrapper.row
    .col-md-12
      ul#distro-list.nav.nav-tabs(role="tablist")
        li(role="presentation")
          a(href="#", role="tab", data-toggle="tab") &nbsp;
    .col-md-8.pull-right
      #carousel.carousel.slide(data-ride="carousel")
        //ol.carousel-indicators
          each dummy, index in params.currentDE.imagePaths
            if index == 0
              li.active(data-target="#carousel", data-slide-to=index)
            else
              li(data-target="#carousel", data-slide-to=index)
        #preview.carousel-inner(role="listbox")
          .item
            a.image-popup-no-margins
              //- (href=path)
              img.afe-mainframe
                //- (src=path, alt=params.currentDE.name + ` preview (${index+1})`)
        a.carousel-control.left(data-slide="prev", role="button", href="#carousel").afe-arrow.afe-arrow-left
        a.carousel-control.right(data-slide="next", role="button", href="#carousel").afe-arrow.afe-arrow-right
    .col-md-4
      h1#distro-name &nbsp;
      p#distro-description &nbsp;

      form#control-panel.form-horizontal
        .form-group
          label.control-label.col-md-6(for="architecture") Architecture
          #arch-selector.dropdown.col-md-6
            button.btn.btn-default.dropdown-toggle(type="button", data-toggle="dropdown")
              | AMD64 &nbsp;
              span.caret
            ul.dropdown-menu
              li: a(href="#") AMD64
              li: a(href="#") ARMv7
              li: a(href="#") MIPS
        .form-group
          label.control-label.col-md-6(for="architecture") Package Manager
          #pm-selector.dropdown.col-md-6
            button.btn.btn-default.dropdown-toggle(type="button", data-toggle="dropdown")
              | DPKG &nbsp;
              span.caret
            ul.dropdown-menu
              li: a(href="#") DPKG (recommended)
              li: a(href="#") RPM
              li: a(href="#") Pacman
        //a.tip.text-center(data-toggle="popover", data-container="body"
          data-placement="top", data-content="And here's some amazing content. It's very engaging. Right?") 为什么会这样呢？
      #download-panel
        a.btn.btn-default.col-md-12.disabled Download Live CD (recommended)
        a.btn.btn-default.col-md-12 Download tarball

append stylesheet
  +include-css("/assets/css/magnific-popup.css")
append javascript
  +include-js("/assets/js/jquery.magnific-popup.min.js")
  script.
    var jsonDistros = null;
    $(function () {
      $.getJSON('/api/distro', function(json) {
        jsonDistros = json;
        initTabs();
      });

      function initTabs() {
        var distroList = $('ul#distro-list');
        var DistroTab = distroList.children().first().removeClass('active').detach();
        distroList.empty();
        for(distroIndex in jsonDistros.generalDistros.list) {
          var distro = jsonDistros.generalDistros.list[distroIndex];
          var distroTab = DistroTab.clone();
          distroTab.data('distro-name', distro.name);
          distroTab.children('a').text(distro.name);
          distroTab.appendTo(distroList);
        }
        distroList.children().first().addClass('active');
        distroList.children().click(function() {
          initTab($(this).data('distro-name'));
        });
        initTab(jsonDistros.generalDistros.list[0].name);
        // FIXME: dockers, buildkits, etc.
      }

      function initTab(distroName) {
        var distro;
        for(distroIndex in jsonDistros.generalDistros.list) {
          distro = jsonDistros.generalDistros.list[distroIndex];
          if(distro.name == distroName) break;
        }
        var distroList = $('ul#distro-list');
        distroList.children().removeClass('active');
        var distroTab = distroList.children('[data-distro-name="' + distroName + '"]');
        distroTab.addClass('active');
        $('#distro-name').text(distro.name);
        $('#distro-description').text(distro.description);

        $.getJSON('/api/distro-extra?name=' + encodeURIComponent(distroName), function(xdistro) {
          var imageList = $('#preview');
          if(xdistro.previewList.length != 0) {
            $('#preview').show();
            var ImageItem = imageList.children().first().removeClass('active').detach();
            imageList.empty();
            for(imageIndex in xdistro.previewList) {
              var image = xdistro.previewList[imageIndex];
              var imageItem = ImageItem.clone();
              imageItem.find('a').attr('href', image.thumbPath);
              imageItem.find('img').attr('src', image.path);
              imageItem.appendTo(imageList);
            }
            imageList.children().first().addClass('active');
            $('.image-popup-no-margins').magnificPopup({
              type: "image",
              closeOnContentClick: true,
              closeBtnInside: false,
              fixedContentPos: true,
              image: {
                verticalFit: true
              },
              zoom: {
                enabled: true,
                duration: 300 // don't foget to change the duration also in CSS
              }
            });
          } else {
            $('#preview').hide();
          }
          var downloadItemList = $('#download-panel');
          var DownloadItem = downloadItemList.children().first().detach();
          downloadItemList.empty();
          for(downloadIndex in xdistro.downloadList) {
            var download = xdistro.downloadList[downloadIndex];
            var downloadItem = DownloadItem.clone();
            downloadItem.children('a')
              .text(download.text)
              .attr('href', download.url)
              .toggleClass('disabled', !download.available);
            downloadItem.appendTo(downloadItemList);
          }
        });
      }
      //$('[data-toggle="popover"]').popover();
    });
