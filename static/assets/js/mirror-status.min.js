var f=[],h,n,r=(new ClientJS).getCPU();function w(b,a,e){var x=Date.now();$.getScript(b+"misc/u-boot-sunxi-with-spl.bin").then(function(){f.push({name:a,a:e/3600*.39+.61*(Date.now()-x),url:b})})}function y(){100<=n?(clearInterval(h),$("#pbar").fadeOut(300,function(){$("#gen-btn").fadeIn(733);$("#pdesc").fadeOut(500)})):(n+=1,$("#pgs")[0].innerText=n+"%",$("#pgs")[0].style="width:"+n+"%;")}
function z(b){var a=document.createElement("a");a.setAttribute("style","display: none;");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(b));a.setAttribute("download","sources.list");document.createEvent?(b=document.createEvent("MouseEvents"),b.initEvent("click",!0,!0),a.dispatchEvent(b)):a.click()}
function cb(){f.sort(function(a,b){return a.score>b.score?1:a.score<b.score?-1:0});for(var b="# Generated by AOSC Mirror Service\n",a=0;a<f.length;a++)var e=a?"# ":"",b=b+("# "+f[a].name+"\n#\n"+e+"deb "+f[a].url+"os-"+r+"/os3-dpkg /\n"+e+"deb "+f[a].url+"os-noarch/os3-dpkg /\n#\n");z(b)}
window.startMeasurement=function(){$("#gen-btn").fadeOut(10);$("#pdesc").fadeIn(1333);$.getJSON("/api/mirror-status",function(b){var a=b.mirrors;$("#pbar").fadeIn(100);n=0;setTimeout(cb,1E4);h=setInterval(y,100);for(var e=0;e<a.length;e++)w(a[e].url,a[e].name,b.repo_info.lupd-a[e].lupd)})};
